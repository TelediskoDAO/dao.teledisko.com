{"version":3,"file":"service-worker.js","sources":["../service-worker/config.js","../service-worker/index.js"],"sourcesContent":["const CONFIG = __buildEnv__;\nexport default CONFIG;\n","import CONFIG from \"./config\";\nconsole.log(\n  \"[Service Worker] Version:\",\n  CONFIG.version,\n  \"Build date:\",\n  new Date(CONFIG.date)\n);\n\nconst cacheName = CONFIG.version + \".\" + CONFIG.date;\nconst contentToCache = [\n  \"fonts/material-icons.woff2\",\n  \"images/icons/ios-share.png\",\n  \"images/logo-152.png\",\n  \"images/logo-167.png\",\n  \"images/logo-180.png\",\n  \"images/logo-192.png\",\n  \"images/logo-512.png\",\n  \"images/shortcut-time-tracking-192.png\",\n  \"images/splash-1125.png\",\n  \"images/splash-1242.png\",\n  \"images/splash-1536.png\",\n  \"images/splash-1668.png\",\n  \"images/splash-2048.png\",\n  \"images/splash-640.png\",\n  \"images/splash-750.png\",\n  \"core.js\",\n  \"bundle.js\",\n  \"components.css\",\n  \"./\",\n  \"manifest.webmanifest\",\n  \"style.css\",\n];\n\nfunction addToCache() {\n  console.log(`[Service Worker ${cacheName}] Caching app`);\n  return caches.open(cacheName).then((cache) =>\n    Promise.all(\n      contentToCache.map((url) =>\n        fetch(`${url}?${CONFIG.date}`).then((response) => {\n          console.log(`[Service Worker] Fetching ${url}?${CONFIG.date}`);\n          if (!response.ok) {\n            console.error(`[Service Worker ${cacheName}] Cannot fetch`, url);\n            throw Error(`Cannot fetch ${url}`);\n          }\n          return cache.put(url, response);\n        })\n      )\n    )\n  );\n}\n\nasync function retrieve({ request }) {\n  let response = await caches.match(request);\n  if (!response) {\n    console.log(`[Service Worker ${cacheName}] Fetch miss`, request.url);\n    response = await fetch(request);\n    // Don't cache responses for now.\n    // const cache = await caches.open(cacheName);\n    // console.log(\"[Service Worker] Caching new resource: \" + request.url);\n    // cache.put(request, response.clone());\n  } else {\n    console.log(`[Service Worker ${cacheName}] Fetch hit`, request.url);\n  }\n  return response;\n}\n\nasync function clearCaches() {\n  console.log(`[Service Worker ${cacheName}] Clear cache`);\n  const keys = (await caches.keys()).filter((key) => key !== cacheName);\n  return Promise.all(keys.map((key) => caches.delete(key)));\n}\n\nfunction register() {\n  console.log(`[Service Worker ${cacheName}] Register Listener: install`);\n  self.addEventListener(\"install\", (e) => {\n    e.waitUntil(addToCache());\n  });\n\n  console.log(`[Service Worker ${cacheName}] Register Listener: fetch`);\n  self.addEventListener(\"fetch\", (e) => {\n    e.respondWith(retrieve(e));\n  });\n\n  console.log(`[Service Worker ${cacheName}] Register Listener: activate`);\n  self.addEventListener(\"activate\", (e) => {\n    console.log(`[Service Worker ${cacheName}] Activate`);\n    e.waitUntil(clearCaches());\n  });\n\n  self.addEventListener(\"message\", function (event) {\n    console.log(\"[Service Worker] Message:\", event);\n    const port = event.ports[0];\n    switch (event.data.method) {\n      case \"skipWaiting\":\n        self.skipWaiting();\n        break;\n      case \"getInfo\":\n        port.postMessage({\n          result: {\n            version: CONFIG.version,\n            date: CONFIG.date,\n          },\n        });\n        break;\n      default:\n        break;\n    }\n  });\n}\n\nregister();\n"],"names":["CONFIG","console","log","Date","cacheName","contentToCache","self","addEventListener","e","waitUntil","caches","open","then","cache","Promise","all","map","url","fetch","response","ok","error","Error","put","respondWith","async","request","match","retrieve","keys","filter","key","delete","clearCaches","event","port","ports","data","method","skipWaiting","postMessage","result","version","date"],"mappings":"yBAAA,MAAMA,gBAAAA,WCCNC,QAAQC,IACN,4BACAF,EACA,cACA,IAAIG,KAAKH,IAGX,MAAMI,EAAYJ,EAAiB,IAAMA,EACnCK,EAAiB,CACrB,6BACA,6BACA,sBACA,sBACA,sBACA,sBACA,sBACA,wCACA,yBACA,yBACA,yBACA,yBACA,yBACA,wBACA,wBACA,UACA,YACA,iBACA,KACA,uBACA,aA2CAJ,QAAQC,IAAI,mBAAmBE,iCAC/BE,KAAKC,iBAAiB,WAAYC,IAChCA,EAAEC,WAzCJR,QAAQC,IAAI,mBAAmBE,kBACxBM,OAAOC,KAAKP,GAAWQ,MAAMC,GAClCC,QAAQC,IACNV,EAAeW,KAAKC,GAClBC,MAAM,GAAGD,KAAOjB,KAAeY,MAAMO,IAEnC,GADAlB,QAAQC,IAAI,6BAA6Be,KAAOjB,MAC3CmB,EAASC,GAEZ,MADAnB,QAAQoB,MAAM,mBAAmBjB,kBAA2Ba,GACtDK,MAAM,gBAAgBL,KAE9B,OAAOJ,EAAMU,IAAIN,EAAKE,gBAkC9BlB,QAAQC,IAAI,mBAAmBE,+BAC/BE,KAAKC,iBAAiB,SAAUC,IAC9BA,EAAEgB,YA7BNC,gBAAwBC,QAAEA,IACxB,IAAIP,QAAiBT,OAAOiB,MAAMD,GAWlC,OAVKP,EAQHlB,QAAQC,IAAI,mBAAmBE,eAAwBsB,EAAQT,MAP/DhB,QAAQC,IAAI,mBAAmBE,gBAAyBsB,EAAQT,KAChEE,QAAiBD,MAAMQ,IAQlBP,EAiBSS,CAASpB,OAGzBP,QAAQC,IAAI,mBAAmBE,kCAC/BE,KAAKC,iBAAiB,YAAaC,IACjCP,QAAQC,IAAI,mBAAmBE,eAC/BI,EAAEC,UApBNgB,iBACExB,QAAQC,IAAI,mBAAmBE,kBAC/B,MAAMyB,SAAcnB,OAAOmB,QAAQC,QAAQC,GAAQA,IAAQ3B,IAC3D,OAAOU,QAAQC,IAAIc,EAAKb,KAAKe,GAAQrB,OAAOsB,OAAOD,MAiBrCE,OAGd3B,KAAKC,iBAAiB,WAAW,SAAU2B,GACzCjC,QAAQC,IAAI,4BAA6BgC,GACzC,MAAMC,EAAOD,EAAME,MAAM,GACzB,OAAQF,EAAMG,KAAKC,QACjB,IAAK,cACHhC,KAAKiC,cACL,MACF,IAAK,UACHJ,EAAKK,YAAY,CACfC,OAAQ,CACNC,QAAS1C,EACT2C,KAAM3C"}