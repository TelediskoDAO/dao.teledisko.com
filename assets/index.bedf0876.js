import{t as x,e as _}from"./tslib.1cb3a792.js";import{c as a,m as l}from"./index.0e8074f8.js";const I="PARSE_ERROR",N="INVALID_REQUEST",D="METHOD_NOT_FOUND",M="INVALID_PARAMS",b="INTERNAL_ERROR",f="SERVER_ERROR",j=[-32700,-32600,-32601,-32602,-32603],h={[I]:{code:-32700,message:"Parse error"},[N]:{code:-32600,message:"Invalid Request"},[D]:{code:-32601,message:"Method not found"},[M]:{code:-32602,message:"Invalid params"},[b]:{code:-32603,message:"Internal error"},[f]:{code:-32e3,message:"Server error"}},O=f;function U(t){return j.includes(t)}function p(t){return Object.keys(h).includes(t)?h[t]:h[O]}function J(t){const e=Object.values(h).find(n=>n.code===t);return e||h[O]}function B(t,e,n){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${n} RPC url at ${e}`):t}var H={},i={},g;function $(){if(g)return i;g=1,Object.defineProperty(i,"__esModule",{value:!0}),i.isBrowserCryptoAvailable=i.getSubtleCrypto=i.getBrowerCrypto=void 0;function t(){return(a===null||a===void 0?void 0:a.crypto)||(a===null||a===void 0?void 0:a.msCrypto)||{}}i.getBrowerCrypto=t;function e(){const s=t();return s.subtle||s.webkitSubtle}i.getSubtleCrypto=e;function n(){return!!t()&&!!e()}return i.isBrowserCryptoAvailable=n,i}var c={},v;function q(){if(v)return c;v=1,Object.defineProperty(c,"__esModule",{value:!0}),c.isBrowser=c.isNode=c.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}c.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}c.isNode=e;function n(){return!t()&&!e()}return c.isBrowser=n,c}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=x.exports;e.__exportStar($(),t),e.__exportStar(q(),t)})(H);function T(t=3){const e=Date.now()*Math.pow(10,t),n=Math.floor(Math.random()*Math.pow(10,t));return e+n}function V(t=6){return BigInt(T(t))}function k(t,e,n){return{id:n||T(),jsonrpc:"2.0",method:t,params:e}}function fe(t,e){return{id:t,jsonrpc:"2.0",result:e}}function G(t,e,n){return{id:t,jsonrpc:"2.0",error:W(e,n)}}function W(t,e){return typeof t>"u"?p(b):(typeof t=="string"&&(t=Object.assign(Object.assign({},p(f)),{message:t})),typeof e<"u"&&(t.data=e),U(t.code)&&(t=J(t.code)),t)}class P{}class de extends P{constructor(e){super()}}class X extends P{constructor(){super()}}class Q extends X{constructor(e){super()}}const z="^https?:",K="^wss?:";function Y(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function S(t,e){const n=Y(t);return typeof n>"u"?!1:new RegExp(e).test(n)}function E(t){return S(t,z)}function le(t){return S(t,K)}function pe(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function A(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function ge(t){return A(t)&&"method"in t}function Z(t){return A(t)&&(ee(t)||F(t))}function ee(t){return"result"in t}function F(t){return"error"in t}class ve extends Q{constructor(e){super(e),this.events=new _.exports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async request(e,n){return this.requestStrict(k(e.method,e.params||[],e.id||V().toString()),n)}async requestStrict(e,n){return new Promise(async(s,r)=>{if(!this.connection.connected)try{await this.open()}catch(o){r(o)}this.events.on(`${e.id}`,o=>{F(o)?r(o.error):s(o.result)});try{await this.connection.send(e,n)}catch(o){r(o)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Z(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const te=t=>JSON.stringify(t,(e,n)=>typeof n=="bigint"?n.toString()+"n":n),ne=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,n=t.replace(e,'$1"$2n"$3');return JSON.parse(n,(s,r)=>typeof r=="string"&&r.match(/^\d+n$/)?BigInt(r.substring(0,r.length-1)):r)};function se(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return ne(t)}catch{return t}}function R(t){return typeof t=="string"?t:te(t)||""}const re={Accept:"application/json","Content-Type":"application/json"},oe="POST",m={headers:re,method:oe},y=10;class Ee{constructor(e,n=!1){if(this.url=e,this.disableProviderPing=n,this.events=new _.exports.EventEmitter,this.isAvailable=!1,this.registering=!1,!E(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=n}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e,n){this.isAvailable||await this.register();try{const s=R(e),o=await(await l(this.url,Object.assign(Object.assign({},m),{body:s}))).json();this.onPayload({data:o})}catch(s){this.onError(e.id,s)}}async register(e=this.url){if(!E(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const n=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=n||this.events.listenerCount("open")>=n)&&this.events.setMaxListeners(n+1),new Promise((s,r)=>{this.events.once("register_error",o=>{this.resetMaxListeners(),r(o)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return r(new Error("HTTP connection is missing or invalid"));s()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const n=R({id:1,jsonrpc:"2.0",method:"test",params:[]});await l(e,Object.assign(Object.assign({},m),{body:n}))}this.onOpen()}catch(n){const s=this.parseError(n);throw this.events.emit("register_error",s),this.onClose(),s}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const n=typeof e.data=="string"?se(e.data):e.data;this.events.emit("payload",n)}onError(e,n){const s=this.parseError(n),r=s.message||s.toString(),o=G(e,r);this.events.emit("payload",o)}parseError(e,n=this.url){return B(e,n,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>y&&this.events.setMaxListeners(y)}}var Re=t=>encodeURIComponent(t).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),L="%[a-f0-9]{2}",w=new RegExp("("+L+")|([^%]+?)","gi"),C=new RegExp("("+L+")+","gi");function u(t,e){try{return[decodeURIComponent(t.join(""))]}catch{}if(t.length===1)return t;e=e||1;var n=t.slice(0,e),s=t.slice(e);return Array.prototype.concat.call([],u(n),u(s))}function ie(t){try{return decodeURIComponent(t)}catch{for(var e=t.match(w)||[],n=1;n<e.length;n++)t=u(e,n).join(""),e=t.match(w)||[];return t}}function ce(t){for(var e={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},n=C.exec(t);n;){try{e[n[0]]=decodeURIComponent(n[0])}catch{var s=ie(n[0]);s!==n[0]&&(e[n[0]]=s)}n=C.exec(t)}e["%C2"]="\uFFFD";for(var r=Object.keys(e),o=0;o<r.length;o++){var d=r[o];t=t.replace(new RegExp(d,"g"),e[d])}return t}var me=function(t){if(typeof t!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return t=t.replace(/\+/g," "),decodeURIComponent(t)}catch{return ce(t)}},ye=(t,e)=>{if(!(typeof t=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e==="")return[t];const n=t.indexOf(e);return n===-1?[t]:[t.slice(0,n),t.slice(n+e.length)]};export{Ee as H,de as I,ve as J,Re as a,R as b,H as c,me as d,pe as e,G as f,se as g,B as h,le as i,ge as j,Z as k,fe as l,ee as m,F as n,k as o,T as p,V as q,ye as s};
